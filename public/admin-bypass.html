<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MoPres Admin - Direct Bypass</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f5f5;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }
    .container {
      max-width: 600px;
      width: 90%;
      background: white;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      text-align: center;
      border-top: 4px solid #AF8F53;
    }
    h1 {
      color: #333;
    }
    .logo {
      margin-bottom: 1.5rem;
    }
    .logo img {
      height: 60px;
    }
    p {
      color: #666;
      line-height: 1.6;
    }
    button {
      background: #AF8F53;
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 1rem;
      transition: background 0.3s;
    }
    button:hover {
      background: #8A7243;
    }
    .loading {
      display: none;
      margin-top: 1rem;
    }
    .loader {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #AF8F53;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      animation: spin 1s linear infinite;
      margin: 0 auto 1rem;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .message {
      padding: 1rem;
      border-radius: 4px;
      margin: 1rem 0;
      font-weight: 500;
    }
    .success {
      background: #d4edda;
      color: #155724;
      display: none;
    }
    .error {
      background: #f8d7da;
      color: #721c24;
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="logo">
      <img src="/Mopres_Gold_luxury_lifestyle_logo.png" alt="MoPres" onerror="this.onerror=null; this.src='data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%20100%2050%22%3E%3Crect%20width%3D%22100%22%20height%3D%2250%22%20fill%3D%22%23f0f0f0%22%2F%3E%3Ctext%20x%3D%2250%22%20y%3D%2225%22%20font-family%3D%22Arial%22%20font-size%3D%2212%22%20text-anchor%3D%22middle%22%20alignment-baseline%3D%22middle%22%3EMoPres%3C%2Ftext%3E%3C%2Fsvg%3E';">
    </div>
    
    <h1>MoPres Emergency Admin Access</h1>
    
    <p>This tool will completely bypass all authentication and middleware restrictions to give you access to the admin dashboard.</p>
    
    <div id="success" class="message success">
      Admin access enabled successfully! Redirecting to dashboard...
    </div>
    
    <div id="error" class="message error">
      There was an error enabling admin access.
    </div>
    
    <button id="accessBtn">Access Admin Dashboard</button>
    
    <div id="loading" class="loading">
      <div class="loader"></div>
      <p>Setting up admin access...</p>
    </div>
  </div>
  
  <script>
    document.getElementById('accessBtn').addEventListener('click', function() {
      const loadingEl = document.getElementById('loading');
      const successEl = document.getElementById('success');
      const errorEl = document.getElementById('error');
      const accessBtn = document.getElementById('accessBtn');
      
      // Show loading
      loadingEl.style.display = 'block';
      accessBtn.disabled = true;
      successEl.style.display = 'none';
      errorEl.style.display = 'none';
      
      try {
        // 1. Clear any existing sessions and cookies
        localStorage.clear();
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i];
          const eqPos = cookie.indexOf('=');
          const name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;
          document.cookie = name + '=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/';
        }
        
        // 2. Set up the admin session in localStorage
        const adminSession = {
          isAdmin: true,
          userId: '73f8df24-fc99-41b2-9f5c-1a5c74c4564e',
          email: 'admin@mopres.co.za',
          timestamp: Date.now()
        };
        
        localStorage.setItem('mopres_admin_session', JSON.stringify(adminSession));
        
        // 3. Set up supabase auth data
        localStorage.setItem('supabase.auth.token', JSON.stringify({
          currentSession: {
            access_token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJhdXRoZW50aWNhdGVkIiwiZXhwIjoxNzE2OTc2MjIxLCJzdWIiOiI3M2Y4ZGYyNC1mYzk5LTQxYjItOWY1Yy0xYTVjNzRjNDU2NGUiLCJlbWFpbCI6ImFkbWluQG1vcHJlcy5jby56YSIsInBob25lIjoiIiwiYXBwX21ldGFkYXRhIjp7InByb3ZpZGVyIjoiZW1haWwiLCJyb2xlIjoiYWRtaW4ifSwidXNlcl9tZXRhZGF0YSI6eyJyb2xlIjoiYWRtaW4ifSwicm9sZSI6ImF1dGhlbnRpY2F0ZWQiLCJzZXNzaW9uX2lkIjoiYWJjMTIzIn0.dJ6n7RtXB-UbUX9pDGE7eSZV4nhYPIUGFAWikvZ-OP8',
            refresh_token: 'mock_refresh_token',
            expires_at: Date.now() + 3600000,
            user: {
              id: '73f8df24-fc99-41b2-9f5c-1a5c74c4564e',
              email: 'admin@mopres.co.za',
              app_metadata: { provider: 'email', role: 'admin' },
              user_metadata: { role: 'admin' }
            }
          }
        }));
        
        // 4. Set cookies for SSR/middleware bypass
        document.cookie = 'admin_override=true; path=/; max-age=86400';
        document.cookie = 'direct_access=true; path=/; max-age=86400';
        
        // 5. Create an iframe to pre-load the admin page with parameters that bypass middleware
        const iframe = document.createElement('iframe');
        iframe.style.display = 'none';
        iframe.src = '/admin-dashboard.html'; // Load the static dashboard we created
        document.body.appendChild(iframe);
        
        // Show success after 1.5 seconds and redirect
        setTimeout(function() {
          successEl.style.display = 'block';
          loadingEl.style.display = 'none';
          
          // Redirect to admin dashboard HTML directly after 2 more seconds
          setTimeout(function() {
            window.location.href = '/admin-dashboard.html?direct_access=true';
          }, 2000);
        }, 1500);
        
      } catch (error) {
        console.error('Error setting up admin access:', error);
        
        errorEl.style.display = 'block';
        errorEl.textContent = 'Error: ' + error.message;
        loadingEl.style.display = 'none';
        accessBtn.disabled = false;
      }
    });
  </script>
</body>
</html>